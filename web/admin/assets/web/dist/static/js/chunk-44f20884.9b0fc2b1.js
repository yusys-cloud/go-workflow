(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-44f20884"],{"27e9":function(t,e,i){},"89fd":function(t,e,i){"use strict";i("9655")},9406:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-row",[i("el-col",{attrs:{span:12}},[i("el-input",{attrs:{placeholder:"请输入内容"},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}},[i("template",{slot:"prepend"},[t._v("流程名称")])],2)],1),i("el-col",{attrs:{span:12}},[i("el-button",{on:{click:t.saveFlow}},[t._v("保存")])],1)],1),i("workflow-chart",{style:t.size,attrs:{transitions:t.transitions,states:t.states,stateSemantics:t.stateSemantics,orientation:"horizontal"},on:{"state-click":function(e){return t.onLabelClicked("state",e)},"transition-click":function(e){return t.onLabelClicked("transition",e)},"size-change":t.sizeChanged}}),i("el-dialog",{attrs:{visible:t.dialogVisible,"close-on-click-modal":"",width:"600px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("el-card",[i("span",[t._v(t._s(t.state.label))]),"start"===t.state.id?i("div",[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.addState("child")}}},[t._v("添加下级")])],1):"end"===t.state.id?i("div",[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.addState("parent")}}},[t._v("添加上级")])],1):i("div",[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.addState("parent")}}},[t._v("添加上级")]),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.addState("same")}}},[t._v("添加同级")]),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.addState("child")}}},[t._v("添加下级")]),i("el-button",{attrs:{type:"danger",size:"mini"},on:{click:t.deleteState}},[t._v("删除")]),i("el-divider"),i("user",{on:{handleUser:t.setUser}})],1)])],1)],1)},a=[],n=(i("b0c0"),i("d3b7"),i("25f0"),i("99af"),i("a434"),i("8420")),r=i.n(n),o=i("b775"),l={getFlow:function(t){return Object(o["a"])({url:"/api/kv/flow/flow/"+t,method:"get"})},saveFlow:function(t){return Object(o["a"])({url:"/api/kv/flow/flow",method:"post",data:t})},updateFlow:function(t,e){return Object(o["a"])({url:"/api/kv/flow/flow/"+t,method:"put",data:e})},getUsers:function(){return Object(o["a"])({url:"/api/kv/user/user",method:"get"})}},d=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-card",{staticStyle:{width:"100%"}},[i("span",[t._v("用户选择")]),i("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,stripe:""}},[i("el-table-column",{attrs:{prop:"name",label:"名称",width:"180",sortable:""}}),i("el-table-column",{attrs:{prop:"des",label:"描述",width:"180",sortable:""}}),i("el-table-column",{attrs:{fixed:"right",label:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){return t.handleUser(e.row)}}},[t._v("选择")])]}}])})],1)],1)],1)},c=[],h={data:function(){return{tableData:[{name:"张三",des:""},{name:"joe",des:"asd"}]}},created:function(){var t=this;l.getUsers().then((function(e){var i=e.data;console.info(i.items[0].v),t.tableData=i.items[0].v}))},methods:{handleUser:function(t){this.$emit("handleUser",t)}}},u=h,f=i("2877"),p=Object(f["a"])(u,d,c,!1,null,null,null),g=p.exports,b={name:"App",components:{WorkflowChart:r.a,user:g},data:function(){return{dialogVisible:!1,state:{},stateIndex:0,id:"",name:"",states:[],transitions:[],stateSemantics:[{classname:"approve",id:"start"},{classname:"approve",id:"end"}],size:{width:"0px",height:"0px"}}},created:function(){var t=this;this.id=this.$route.query.id,this.id?l.getFlow(this.id).then((function(e){var i=e.data;t.states=i.items.v.states,t.transitions=i.items.v.transitions,t.name=i.items.v.name})):(this.states=[{id:"start",label:"开始"},{id:"end",label:"结束"}],this.transitions=[{id:"Dz2un1r",source:"start",target:"end"}])},methods:{saveFlow:function(){var t={name:this.name,states:this.states,transitions:this.transitions,time:this.getTime()};this.id?l.updateFlow(this.id,t):l.saveFlow(t)},getId:function(){return Math.random().toString(32).substr(2)},getTime:function(){var t=new Date;return t.getFullYear()+"-"+(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-"+(t.getDate()<10?"0"+t.getDate():t.getDate())+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()},onLabelClicked:function(t,e){this.dialogVisible=!0,this.state=this.getValue(this.states,e),this.stateIndex=this.states.indexOf(this.state)},setUser:function(t){this.state.label=t.name,this.updateState()},updateState:function(){console.info(this.state),this.states[this.stateIndex]=this.state,this.dialogVisible=!1},addState:function(t){var e={id:this.getId(),label:"待设置"};this.states.push(e);var i=[];if("parent"==t){for(var s=0;s<this.transitions.length;s++)if(this.transitions[s].target==this.state.id){this.transitions[s].target=e.id;var a={id:this.getId(),label:"",source:e.id,target:this.state.id};i.push(a)}}else if("child"==t){for(s=0;s<this.transitions.length;s++)if(this.transitions[s].source==this.state.id){this.transitions[s].source=e.id;a={id:this.getId(),label:"",source:this.state.id,target:e.id};i.push(a)}}else for(s=0;s<this.transitions.length;s++){if(this.transitions[s].source==this.state.id){a={id:this.getId(),label:"",source:e.id,target:this.transitions[s].target};i.push(a)}if(this.transitions[s].target==this.state.id){a={id:this.getId(),label:"",source:this.transitions[s].source,target:e.id};i.push(a)}}this.transitions=this.transitions.concat(i),this.dialogVisible=!1},deleteState:function(){for(var t=[],e="",i=[],s=0;s<this.transitions.length;s++)this.transitions[s].source==this.state.id?e=this.transitions[s].target:this.transitions[s].target==this.state.id?i.push(this.transitions[s].source):t.push(this.transitions[s]);if(""!=e&&i.length>0)for(var a in i)t.push({id:this.getId(),label:"",source:i[a],target:e});this.transitions=t;var n=this.states.indexOf(this.state);n>-1&&this.states.splice(n,1),this.dialogVisible=!1},getValue:function(t,e){for(var i=0;i<t.length;i++)if(t[i].id==e)return console.log(t[i].label),t[i]},sizeChanged:function(t){this.size={width:"".concat(t.width,"px"),height:"".concat(t.height,"px")}}}},m=b,v=(i("89fd"),i("f886"),Object(f["a"])(m,s,a,!1,null,"080912fa",null));e["default"]=v.exports},9655:function(t,e,i){},f886:function(t,e,i){"use strict";i("27e9")}}]);